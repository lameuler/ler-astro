<div class="group">
    <button class="dark:hidden block" id="theme-switch-light" aria-label="Switch to dark theme">
        { Astro.slots.has('light') ? <slot name="light"/> : <svg class="icon h-6 w-6" viewBox="0 0 24 24">
            <path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0" />
            <path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7" />
        </svg> }
    </button>
    <button class="hidden dark:block" id="theme-switch-dark" aria-label="Switch to light theme">
        { Astro.slots.has('dark') ? <slot name="dark"/> : <svg class="icon h-6 w-6" viewBox="0 0 24 24">
            <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
            <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2" />
            <path d="M19 11h2m-1 -1v2" />
        </svg> }
    </button>
</div>

<script>
    const update = () => {
        const dark = document.documentElement.classList.contains('dark')
        localStorage.setItem('appearance:dark', dark+':'+mediaDark.matches)
    }

    let mediaDark = matchMedia('(prefers-color-scheme: dark)')
    mediaDark.addEventListener('change', ()=>{
        if (mediaDark.matches) document.documentElement.classList.add('dark')
        else document.documentElement.classList.remove('dark')
        update()
    })
    
    document.getElementById('theme-switch-light')?.addEventListener('click', ()=>{
        document.documentElement.classList.add('dark')
        update()
    })
    document.getElementById('theme-switch-dark')?.addEventListener('click', ()=>{
        document.documentElement.classList.remove('dark')
        update()
    })
</script>

<script is:inline id="theme-script">
    const system = matchMedia('(prefers-color-scheme: dark)').matches
    const stored = (localStorage.getItem('appearance:dark') || '').split(':')
    let dark = false
    if (stored[1] === system.toString() && (stored[0] === 'true' || stored[0] === 'false')) dark = stored[0] === 'true'
    else dark = system
    if (dark) document.documentElement.classList.add('dark')
    else document.documentElement.classList.remove('dark')

    document.getElementById('theme-script').remove() // cleanup :)
</script>